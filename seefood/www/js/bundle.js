"use strict";angular.module("seeFoodApp",["ionic","ui.router","ngCordova","ngLodash","firebase","uiGmapgoogle-maps"]).constant("FirebaseUrl","http://seefoodapp.firebaseapp.com").service("rootRef",["FirebaseUrl",Firebase]).config(["$stateProvider","$urlRouterProvider",function(t,e){function a(t,e){t.$onAuth(function(t){null===t&&e.go("home")})}a.$inject=["Auth","$state"],t.state("home",{url:"/",templateUrl:"home/partials/home.html",controller:"homeCtrl"}).state("swipe",{url:"/photos",templateUrl:"./swipe/partials/swipe.html",controller:"swipeCtrl",onEnter:a}).state("list",{url:"/list",templateUrl:"./list/partials/list.html",controller:"listCtrl",onEnter:a}).state("detail",{url:"/detail/:id",templateUrl:"./detail/partials/detail.html",controller:"detailCtrl",onEnter:a}),e.otherwise("/")}]).constant("API","http://seefoodapp.herokuapp.com").run(["$ionicPlatform","$cordovaGeolocation","RestaurantService",function(t,e,a){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),a.findMe()})}]);var app=angular.module("seeFoodApp");app.controller("detailCtrl",["$scope","$stateParams","RestaurantService","$state",function(t,e,a,o){function n(){var e={lat:t.restaurant.location.coordinate.latitude,lng:t.restaurant.location.coordinate.longitude},a=new google.maps.Map(document.getElementById("map"),{zoom:13,center:e});new google.maps.Marker({position:e,map:a,title:"Hello World!"})}t.restaurant=a.findLike(e),t.distanceInMiles=function(t){return Math.round(.000621371192*t)},n()}]);var app=angular.module("seeFoodApp");app.controller("homeCtrl",["$scope","Auth","$state",function(t,e,a){t.login=function(t,o){e.$authWithOAuthPopup(t).then(function(t){})["catch"](function(t){a.go("home")})},e.$onAuth(function(e){null===e||a.go("swipe"),t.authData=e})}]);var app=angular.module("seeFoodApp");app.controller("listCtrl",["RestaurantService","$scope","$state",function(t,e,a){e.likes=t.grabLikes(),e.seeDetails=function(t){a.go("detail",{id:t.id})}}]);var app=angular.module("seeFoodApp");app.controller("mainCtrl",["$scope","$ionicModal","RestaurantService","Auth","$state",function(t,e,a,o,n){e.fromTemplateUrl("filters/options.html",{scope:t}).then(function(e){t.modal=e})["catch"](function(t){return console.error("modal err: ",t)}),t.openModal=function(){t.modal.show()},t.closeModal=function(){t.modal.hide()},t.cancelModal=function(){t.modal.hide()},t.createFilter=function(e){e&&(a.clearRestaurant(),a.buildFilter(e),t.modal.hide())},t.logout=function(){n.go("home"),t.authData=null,window.localStorage.clear(),t.modal.hide()},o.$onAuth(function(e){null===e?n.go("home"):n.go("swipe"),t.authData=e})}]);var app=angular.module("seeFoodApp");app.controller("swipeCtrl",["$scope","RestaurantService","$state","$ionicLoading",function(t,e,a,o){t.$watch(function(){return e.restaurants},function(e,a){o.hide(),t.restaurant=e[0]});document.getElementById("pic");t.rejected=function(){e.swipeRestaurant(),t.restaurant=e.grabRestaurant()},t.accepted=function(){e.addLike(),e.swipeRestaurant(),t.restaurant=e.grabRestaurant()}}]);var app=angular.module("seeFoodApp");app.factory("Auth",["$firebaseAuth",function(t){var e="https://seefoodapp.firebaseio.com",a=new Firebase(e);return t(a)}]);var app=angular.module("seeFoodApp");app.service("RestaurantService",["$http","API","$cordovaGeolocation",function(t,e,a){this.restaurants=[],this.likes=[],this.filterObj={},this.findMe=function(){var t=this,e={enableHighAccuracy:!0,timeout:2e4,maximumAge:0},o=window.setTimeout(function(){t.filterObj={lat:37.5489946970847,lng:-121.9429642028612},t.buildFilter(t.filterObj)},1e4);a.getCurrentPosition(e).then(function(e){window.clearTimeout(o),t.filterObj={lat:e.coords.latitude,lng:e.coords.longitude},t.buildFilter(t.filterObj)})},this.setRestaurants=function(t){t.businesses=_.shuffle(t.businesses),this.restaurants=this.restaurants.concat(t.businesses)},this.swipeRestaurant=function(){this.restaurants.splice(0,1),5===this.restaurants.length&&this.getRestaurants()},this.grabRestaurant=function(){return this.restaurants[0]},this.clearRestaurant=function(){this.restaurants=[]},this.grabLikes=function(){return this.likes},this.addLike=function(){this.likes.push(this.restaurants[0])},this.findLike=function(t){for(var e=0;e<this.likes.length;e++)if(this.likes[e].id===t.id)return this.likes[e]},this.buildFilter=function(t){var e=this,a=[];this.filterObj.count=0,this.filterObj.radius=t.radius?1600*t.radius:16e3,this.filterObj.category="",t.glutenFree?a.push("gluten_free"):"",t.vegetarian?a.push("vegetarian"):"",t.vegan?a.push("vegan"):"",t.kosher?a.push("kosher"):"",this.filterObj.category=a.join(","),t.location?this.getCoords(t.location).then(function(t){e.filterObj.lat=t.data.results[0].geometry.location.lat,e.filterObj.lng=t.data.results[0].geometry.location.lng,e.getRestaurants()},function(t){console.error(t)}):this.getRestaurants()},this.getRestaurants=function(){var a=this;return t.put(e+"/restaurants",this.filterObj).then(function(t){t.data.businesses.forEach(function(e,a,o){e.image_url?e.image_url=e.image_url.replace(/\S{2}(\.jpg)$/,"o.jpg"):t.data.businesses.splice(o.indexOf(e),1)}),a.filterObj.count+=t.data.businesses.length,a.setRestaurants(t.data)},function(t){console.error(t)})},this.getCoords=function(e){var a=e.split(" ").join("+");return t.get("https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyCVFibjTMF6wEQUlCV_O5zILn5urQUZ6Zo&address="+a)}}]);